<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administración - Terrenos Premium</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/admin.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Login Section -->
    <div id="login-section" class="login-container">
        <div class="login-box">
            <div class="logo">
                <h2><i class="fas fa-map-marked-alt"></i> Terrenos Premium</h2>
                <p>Panel de Administración</p>
            </div>
            <form id="login-form">
                <div class="form-group">
                    <label for="username">Usuario</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="password">Contraseña</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit" class="btn-primary">Iniciar Sesión</button>
            </form>
            <div id="login-error" class="error-message" style="display: none;"></div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="admin-panel" class="admin-panel" style="display: none;">
        <!-- Header -->
        <header class="admin-header">
            <div class="admin-nav">
                <div class="logo">
                    <h2><i class="fas fa-map-marked-alt"></i> Panel Admin</h2>
                </div>
                <div class="admin-actions">
                    <button onclick="showSection('terrains')" class="nav-btn active" id="terrains-btn">
                        <i class="fas fa-map"></i> Terrenos
                    </button>
                    <button onclick="showSection('create')" class="nav-btn" id="create-btn">
                        <i class="fas fa-plus"></i> Crear Terreno
                    </button>
                    <button onclick="showSection('upload')" class="nav-btn" id="upload-btn">
                        <i class="fas fa-upload"></i> Subir Imágenes
                    </button>
                    <button onclick="showSection('users')" class="nav-btn" id="users-btn">
                        <i class="fas fa-users"></i> Usuarios
                    </button>
                    <button onclick="showSection('website')" class="nav-btn" id="website-btn">
                        <i class="fas fa-globe"></i> Ver Sitio Web
                    </button>
                    <button onclick="logout()" class="nav-btn logout-btn">
                        <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                    </button>
                </div>
            </div>
        </header>

        <!-- Terrains Management Section -->
        <section id="terrains-section" class="admin-section">
            <div class="container">
                <h2>Gestión de Terrenos</h2>
                <div class="terrains-grid" id="admin-terrains-grid">
                    <!-- Los terrenos se cargarán aquí dinámicamente -->
                </div>
            </div>
        </section>

        <!-- Create Terrain Section -->
        <section id="create-section" class="admin-section" style="display: none;">
            <div class="container">
                <h2>Crear Nuevo Terreno</h2>
                <div class="create-terrain-form">
                    <form id="create-terrain-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="create-name">Nombre del Terreno *</label>
                                <input type="text" id="create-name" name="name" required placeholder="Ej: Terreno Residencial Las Palmas">
                            </div>
                            <div class="form-group">
                                <label for="create-price">Precio *</label>
                                <input type="text" id="create-price" name="price" required placeholder="$2,500,000 MXN">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="create-location">Ubicación *</label>
                                <input type="text" id="create-location" name="location" required placeholder="Zona Norte, Ciudad">
                            </div>
                            <div class="form-group">
                                <label for="create-size">Tamaño *</label>
                                <input type="text" id="create-size" name="size" required placeholder="750 m²">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="create-badge">Etiqueta</label>
                                <select id="create-badge" name="badge">
                                    <option value="">Sin etiqueta</option>
                                    <option value="Destacado">Destacado</option>
                                    <option value="Nuevo">Nuevo</option>
                                    <option value="Oferta">Oferta</option>
                                    <option value="Vendido">Vendido</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="create-coordinates">Coordenadas (Lat, Lng)</label>
                                <input type="text" id="create-coordinates" name="coordinates" placeholder="19.4326, -99.1332">
                                <button type="button" onclick="openLocationPicker()" class="btn-secondary btn-small">
                                    <i class="fas fa-map-marker-alt"></i> Seleccionar en Mapa
                                </button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="create-description">Descripción *</label>
                            <textarea id="create-description" name="description" rows="4" required 
                                placeholder="Describe las características principales del terreno..."></textarea>
                        </div>

                        <div class="form-group">
                            <label>Características del Terreno</label>
                            <div class="features-input">
                                <input type="text" id="feature-input" placeholder="Agregar característica">
                                <button type="button" onclick="addFeature()" class="btn-secondary">
                                    <i class="fas fa-plus"></i> Agregar
                                </button>
                            </div>
                            <div id="features-list" class="features-list"></div>
                        </div>

                        <div class="form-group">
                            <label>Imágenes del Terreno</label>
                            <div class="image-upload-area">
                                <div class="upload-box-small" onclick="document.getElementById('terrain-images').click()">
                                    <i class="fas fa-camera"></i>
                                    <p>Subir Imágenes</p>
                                </div>
                                <input type="file" id="terrain-images" multiple accept="image/*" style="display: none;">
                                <div id="terrain-images-preview" class="images-preview"></div>
                            </div>
                        </div>

                        <div class="form-buttons">
                            <button type="submit" class="btn-primary">
                                <i class="fas fa-save"></i> Crear Terreno
                            </button>
                            <button type="button" onclick="resetCreateForm()" class="btn-secondary">
                                <i class="fas fa-undo"></i> Limpiar Formulario
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </section>

        <!-- Upload Images Section -->
        <section id="upload-section" class="admin-section" style="display: none;">
            <div class="container">
                <h2>Subir Nuevas Imágenes</h2>
                <div class="upload-area">
                    <div class="upload-box" id="upload-box">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Arrastra las imágenes aquí o haz clic para seleccionar</p>
                        <input type="file" id="file-input" multiple accept="image/*" style="display: none;">
                        <button type="button" onclick="document.getElementById('file-input').click()" class="btn-primary">
                            Seleccionar Imágenes
                        </button>
                    </div>
                    <div id="upload-preview" class="upload-preview"></div>
                </div>
            </div>
        </section>

        <!-- Users Management Section -->
        <section id="users-section" class="admin-section" style="display: none;">
            <div class="container">
                <h2>Gestión de Usuarios</h2>
                <div class="users-stats">
                    <div class="stat-card">
                        <i class="fas fa-users"></i>
                        <div class="stat-info">
                            <h3 id="total-users">0</h3>
                            <p>Total Usuarios</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-user-plus"></i>
                        <div class="stat-info">
                            <h3 id="new-users">0</h3>
                            <p>Nuevos Hoy</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-user-check"></i>
                        <div class="stat-info">
                            <h3 id="active-users">0</h3>
                            <p>Activos</p>
                        </div>
                    </div>
                </div>
                <div class="users-table">
                    <div class="table-header">
                        <h3>Lista de Usuarios</h3>
                        <button onclick="exportUsers()" class="btn-secondary">
                            <i class="fas fa-download"></i> Exportar
                        </button>
                    </div>
                    <div class="table-container">
                        <table id="users-table">
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Email</th>
                                    <th>Teléfono</th>
                                    <th>Interés</th>
                                    <th>Registro</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body">
                                <!-- Users will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Website Preview Section -->
        <section id="website-section" class="admin-section" style="display: none;">
            <div class="container">
                <h2>Vista Previa del Sitio Web</h2>
                <div class="website-preview">
                    <div class="preview-controls">
                        <button onclick="openWebsite()" class="btn-primary">
                            <i class="fas fa-external-link-alt"></i> Abrir Sitio Web
                        </button>
                        <button onclick="refreshPreview()" class="btn-secondary">
                            <i class="fas fa-sync"></i> Actualizar Vista
                        </button>
                    </div>
                    <div class="preview-frame">
                        <iframe id="website-iframe" src="index.html" width="100%" height="600px"></iframe>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Edit Terrain Modal -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditModal()">&times;</span>
            <h2>Editar Terreno</h2>
            <form id="edit-form">
                <input type="hidden" id="edit-terrain-id">
                <div class="form-group">
                    <label for="edit-name">Nombre del Terreno</label>
                    <input type="text" id="edit-name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="edit-price">Precio</label>
                    <input type="text" id="edit-price" name="price" required placeholder="$1,500,000 MXN">
                </div>
                <div class="form-group">
                    <label for="edit-location">Ubicación</label>
                    <input type="text" id="edit-location" name="location" required>
                </div>
                <div class="form-group">
                    <label for="edit-size">Tamaño</label>
                    <input type="text" id="edit-size" name="size" required placeholder="500 m²">
                </div>
                <div class="form-group">
                    <label for="edit-badge">Etiqueta (opcional)</label>
                    <select id="edit-badge" name="badge">
                        <option value="">Sin etiqueta</option>
                        <option value="Destacado">Destacado</option>
                        <option value="Nuevo">Nuevo</option>
                        <option value="Oferta">Oferta</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit-description">Descripción</label>
                    <textarea id="edit-description" name="description" rows="4" required></textarea>
                </div>
                <div class="form-buttons">
                    <button type="submit" class="btn-primary">Guardar Cambios</button>
                    <button type="button" onclick="closeEditModal()" class="btn-secondary">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Location Picker Modal -->
    <div id="location-modal" class="modal">
        <div class="modal-content modal-large">
            <span class="close" onclick="closeLocationModal()">&times;</span>
            <h2>Seleccionar Ubicación</h2>
            <div class="location-picker">
                <div id="map" style="height: 400px; width: 100%; border-radius: 8px;"></div>
                <div class="location-info">
                    <p>Haz clic en el mapa para seleccionar la ubicación del terreno</p>
                    <div class="coordinates-display">
                        <strong>Coordenadas seleccionadas:</strong>
                        <span id="selected-coordinates">No seleccionadas</span>
                    </div>
                    <button onclick="confirmLocation()" class="btn-primary">Confirmar Ubicación</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/admin.js"></script>
    <script>
        // Simple map functionality (you can replace with Google Maps or other service)
        function initSimpleMap() {
            const mapDiv = document.getElementById('map');
            if (mapDiv) {
                mapDiv.innerHTML = `
                    <div style="position: relative; width: 100%; height: 100%; background: #e0e0e0; display: flex; align-items: center; justify-content: center; cursor: crosshair;" onclick="selectLocation(event)">
                        <div style="text-align: center; color: #666;">
                            <i class="fas fa-map-marked-alt" style="font-size: 48px; margin-bottom: 10px;"></i>
                            <p>Haz clic para seleccionar ubicación</p>
                            <small>Coordenadas: <span id="map-coords">19.4326, -99.1332</span></small>
                        </div>
                        <div id="location-marker" style="position: absolute; display: none;">
                            <i class="fas fa-map-marker-alt" style="color: red; font-size: 24px;"></i>
                        </div>
                    </div>
                `;
            }
        }

        function selectLocation(event) {
            const rect = event.currentTarget.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            
            // Convert to approximate coordinates (this is simplified)
            const lat = 19.4326 + (y - rect.height/2) * 0.001;
            const lng = -99.1332 + (x - rect.width/2) * 0.001;
            
            const marker = document.getElementById('location-marker');
            marker.style.left = x + 'px';
            marker.style.top = y + 'px';
            marker.style.display = 'block';
            
            const coords = lat.toFixed(4) + ', ' + lng.toFixed(4);
            document.getElementById('map-coords').textContent = coords;
            document.getElementById('selected-coordinates').textContent = coords;
            
            window.selectedCoordinates = coords;
        }

        function confirmLocation() {
            if (window.selectedCoordinates) {
                document.getElementById('create-coordinates').value = window.selectedCoordinates;
                closeLocationModal();
                showNotification('Ubicación seleccionada correctamente', 'success');
            } else {
                showNotification('Por favor selecciona una ubicación en el mapa', 'error');
            }
        }
    </script>
</body>
</html>
